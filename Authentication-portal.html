<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Site Entrance Portal</title>

    <!-- Tailwind CDN -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Font -->
    <link href="https://fonts.googleapis.com/css2?family=EB+Garamond:wght@400;500;700&display=swap" rel="stylesheet">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['EB Garamond', 'serif'],
                    },
                    colors: {
                        backgroundBase: '#f0f8ff',
                        primaryDark: '#0A296C',
                        accentGold: '#DFBD16',
                        boxBorderBlue: '#22639b',
                        successGreen: '#10b981',
                        errorRed: '#ef4444'
                    }
                }
            }
        }
    </script>
</head>

<body class="bg-backgroundBase min-h-screen flex items-center justify-center p-4 font-sans text-primaryDark">

<div class="max-w-md w-full bg-white rounded-xl p-6 md:p-8 border-4 border-boxBorderBlue shadow-xl">

    <div class="text-center mb-8">
        <h1 class="text-3xl font-bold mb-2">
            St. Teresa's School Website
        </h1>
        <p class="text-gray-600">
            Welcome. Click below to enter the site.
        </p>
    </div>

    <!-- Info box -->
    <div class="mb-6 p-4 border border-dashed border-boxBorderBlue rounded-lg bg-blue-50">
        <p class="font-medium">
            Authentication is set to "Open Access".
        </p>
        <p class="text-sm text-gray-500 mt-1">
            Session persists for this browser session.
        </p>
    </div>

    <!-- Button -->
    <button
        id="enterSiteBtn"
        class="w-full py-3 rounded-xl font-bold text-white bg-primaryDark hover:bg-boxBorderBlue transition transform hover:scale-[1.02] shadow-lg">
        Enter Site
    </button>

    <!-- Status -->
    <div id="status" class="hidden mt-6 p-4 rounded-lg border">
        <p class="font-bold mb-1">Status:</p>
        <p id="statusMessage" class="text-sm"></p>
    </div>

</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.11.0/firebase-app.js";
    import {
        getAuth,
        signInAnonymously,
        onAuthStateChanged,
        setPersistence,
        browserSessionPersistence
    } from "https://www.gstatic.com/firebasejs/11.11.0/firebase-auth.js";

    const firebaseConfig =
        typeof __firebase_config !== 'undefined'
            ? JSON.parse(__firebase_config)
            : null;

    const statusBox = document.getElementById('status');
    const statusMessage = document.getElementById('statusMessage');
    const enterSiteBtn = document.getElementById('enterSiteBtn');

    let auth;

    function showStatus(message, isError = false) {
        statusBox.classList.remove('hidden');
        statusBox.className =
            `mt-6 p-4 rounded-lg border ${
                isError ? 'border-errorRed text-errorRed' : 'border-successGreen'
            }`;
        statusMessage.textContent = message;
    }

    function redirect(user) {
        showStatus(`Authentication successful. Redirecting...`);
        setTimeout(() => {
            window.location.href = 'index.html';
        }, 500);
    }

    async function initializeFirebase() {
        if (!firebaseConfig) {
            showStatus("Firebase configuration missing.", true);
            enterSiteBtn.disabled = true;
            return;
        }

        const app = initializeApp(firebaseConfig);
        auth = getAuth(app);

        await setPersistence(auth, browserSessionPersistence);

        onAuthStateChanged(auth, user => {
            if (user) {
                redirect(user);
            } else {
                showStatus("Click 'Enter Site' to proceed.");
                enterSiteBtn.disabled = false;
            }
        });
    }

    async function handleEnterSite() {
        enterSiteBtn.disabled = true;
        showStatus("Signing in anonymously...");
        try {
            await signInAnonymously(auth);
        } catch (err) {
            showStatus(err.message, true);
            enterSiteBtn.disabled = false;
        }
    }

    enterSiteBtn.addEventListener('click', handleEnterSite);
    initializeFirebase();
</script>

</body>
</html>
    